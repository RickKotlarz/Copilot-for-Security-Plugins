Descriptor:
  Name: ADX search demo
  DisplayName: ADX search demo
  Description: ADX search demo
      
  SupportedAuthTypes:
    - None
    
SkillGroups:
  - Format: KQL
    Skills:

#######################################################################################
## ADX demo
#######################################################################################
# 
########################################################################################

      - Name: GetADXAlipineLogs
        DisplayName: GetADXAlipineLogs
        Description: |
          Gets top n rows of the Alipine ADX cluster sorted by TimeGenerated
          #ExamplePrompts Gets the top 10 rows of the GCPAuditLogs table from the Alipine ADX cluster and sort by TimeGenerated
        Inputs:
          - Name: numberOfRows
            Description: Number of rows you wish to return from the top (.e.g. 10)
            Required: true
        Settings:
          Target: Kusto
          Cluster: https://alipine-cluster01.eastus.kusto.windows.net
          Database: DB01
          Template: |-
            GCPAuditLogs
              | sort by TimeGenerated desc
              | take {{numberOfRows}}

########################################################################################
      - Name: SearchADXTables
        DisplayName: SearchADXTables
        Description: |
          Searches the ServiceName and RequestMetadata tables for data.
          Output from these results should be shown in a table format
          #ExamplePrompts Search for 'logging.googleapis.com' in the ServiceName table within the Alipine ADX cluster
          #ExamplePrompts Search for '75.155.231.45' in the RequestMetadata table within the Alipine ADX cluster          
        Inputs:
          - Name: ServiceNameSearch
            Description: ServiceName search query (e.g. logging.googleapis.com, monitoring.googleapis.com ).
            Required: false
          - Name: RequestMetadataSearch
            Description: RequestMetadata search query (e.g. 75.155.231.45, 99.199.108.41).
            Required: false
        Settings:
          Target: Kusto
          Cluster: https://alipine-cluster01.eastus.kusto.windows.net
          Database: DB01
          Template: |-
            //Output from these results should be shown in a table format
            GCPAuditLogs
              | where ServiceName contains '{{ServiceNameSearch}}' and RequestMetadata contains '{{RequestMetadataSearch}}'
              | sort by TimeGenerated desc

########################################################################################
             
      - Name: GetADXLogsOverLastNdays
        DisplayName: GetADXLogsOverLastNdays
        Description: |
          Gets ADX logs between now and the last n number of days
          #ExamplePrompts Gets ADX logs within the last 90 days
        Inputs:
          - Name: dayRange
            Description: The time range for the query (e.g., 1d, 7d, 90d)
            Required: true
        Settings:
          Target: Kusto
          Cluster: https://alipine-cluster01.eastus.kusto.windows.net
          Database: DB01
          Template: |-
            GCPAuditLogs
              | where TimeGenerated <= ago({{dayRange}})
              | sort by TimeGenerated desc
             
########################################################################################
